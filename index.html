<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Generador de QR</title>
  <style>
    
  body {
    font-family: system-ui, Segoe UI, Roboto, Arial, sans-serif;
    line-height: 1.5;
    padding: 20px;
    background: #f7f7fb;
    color: #333;
  }

  .card {
    background: #ffffff;
    padding: 20px;
    border-radius: 16px;
    box-shadow: 0 8px 30px rgba(15, 15, 30, 0.1);
    max-width: 760px;
    margin: 20px auto;
    border-top: 5px solid #ffb81c;
  }

  label {
    display: block;
    margin: 12px 0 8px;
    font-weight: 600;
    color: #333;
  }

  input[type="text"] {
    width: 97%;
    padding: 12px;
    border-radius: 10px;
    border: 1px solid #f1c40f; 
    background-color: #fef6e4;
    font-size: 14px;
    color: #333;
  }

  .row {
    display: flex;
    gap: 12px;
    align-items: center;
  }

  button {
    padding: 12px 16px;
    border-radius: 10px;
    border: 0;
    background: #f39c12; 
    color: white;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.3s ease;
    margin: 8px 0; 
  }

  button:hover {
    background: #e67e22; 
  }

  button.secondary {
    background: #f1c40f; 
  }

  button.secondary:hover {
    background: #f39c12; 
  }

  .preview {
    display: flex;
    gap: 20px;
    align-items: center;
    margin-top: 16px;
  }

  canvas {
    background: #fff;
    border: 1px solid #eee;
    border-radius: 8px;
  }

  .hint {
    color: #777;
    font-size: 14px;
    margin-top: 10px;
  }

  .controls {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }


  .card-header {
    font-size: 18px;
    font-weight: 700;
    color: #f39c12;
    margin-bottom: 20px;
  }

  .card-footer {
    margin-top: 20px;
    text-align: center;
    font-size: 14px;
    color: #f39c12;
  }

  
  .preview-container {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: space-between;
  }
</style>

</head>
<body>
  <div class="card">
    <h2>Generador de QR con descarga en HD</h2>
    <p class="hint">Escribe un enlace, Clic en generar QR y descárgalo en alta resolución.</p>

    <label for="text">Enlace o texto</label>
    <input id="text" type="text" placeholder="https://ejemplo.com" value="https://example.com">

    <div class="row" style="margin-top:10px">
      <div style="flex:1">
        <label for="size">Tamaño de vista previa</label>
        <input id="size" type="range" min="128" max="512" value="256">
      </div>
      <div style="width:130px;text-align:right">
        <label>Modo</label>
        <select id="mode">
          <option value="png">PNG (HD)</option>
          
        </select>
      </div>
    </div>

    <div class="controls" style="margin-top:12px">
      <button id="generate">Generar QR</button>
      <button id="download" class="secondary">Descargar HD</button>
      <button id="copy" class="secondary">Copiar imagen al portapapeles</button>
    </div>

    <div class="preview">
      <div>
        <label>Previsualización</label>
        <canvas id="qr" width="256" height="256"></canvas>
        <div class="hint">Resolución de previsualización actual: <span id="previewSize">256</span>×<span id="previewSize2">256</span> px</div>
      </div>
      <div style="flex:1">
        <label>Información</label>
        <div class="hint">Para descargar en alta definición, pulsa "Descargar HD". Esto renderiza un PNG a la resolución seleccionada (ej. 2048×2048) y lo descarga.</div>
        <div style="margin-top:8px">
          <label for="hdsize">Resolución HD (px)</label>
          <input id="hdsize" type="number" min="512" max="4096" value="2048" style="width:140px;padding:8px;border-radius:6px;border:1px solid #ddd">
        </div>
      </div>
    </div>
  </div>

 <script src="https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js"></script>
 <script src="https://www.gstatic.com/firebasejs/9.1.2/firebase-firestore.js"></script>
 <script>
  // Inicialización de Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyAYRw4zlelb9zG3N7g9-plKua9qKrUV-oc",
    authDomain: "generadorqrcontador.firebaseapp.com",
    projectId: "generadorqrcontador",
    storageBucket: "generadorqrcontador.firebasestorage.app",
    messagingSenderId: "348897089593",
   appId: "1:348897089593:web:84ba0ebb275bd29f6015e8",
    measurementId: "G-MC4N0B5WJN"
  };

  // Inicializa Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore(app);
</script>
  <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
  <script>
    const input = document.getElementById('text');
    const sizeRange = document.getElementById('size');
    const previewSizeSpan = document.getElementById('previewSize');
    const previewSizeSpan2 = document.getElementById('previewSize2');
    const canvas = document.getElementById('qr');
    const generateBtn = document.getElementById('generate');
    const downloadBtn = document.getElementById('download');
    const copyBtn = document.getElementById('copy');
    const hdSizeInput = document.getElementById('hdsize');
    const modeSelect = document.getElementById('mode');

    
    const qr = new QRious({
      element: canvas,
      value: input.value,
      size: parseInt(sizeRange.value,10),
      background: 'white',
      level: 'H' 
    });

    function updatePreviewSize(){
      const s = parseInt(sizeRange.value,10);
      canvas.width = s;
      canvas.height = s;
      qr.size = s;
      previewSizeSpan.textContent = s;
      previewSizeSpan2.textContent = s;
    }

    sizeRange.addEventListener('input', updatePreviewSize);

    generateBtn.addEventListener('click', ()=>{
      qr.value = input.value || '';
      
      updatePreviewSize();
    }); 

    
    downloadBtn.addEventListener('click', async ()=>{
      const text = input.value || '';
      if(!text){
        alert('Escribe primero un enlace o texto.');
        return;
      }

      if(modeSelect.value === 'svg'){
        // Generar SVG simple usando QRius -> convertir a imagen SVG construyendo un SVG con image href a un dataURL del canvas.
        // Nota: QRious no exporta SVG nativo; si necesitas un SVG puro vectorial usa librerías dedicadas.
        const tmp = document.createElement('canvas');
        const hd = parseInt(hdSizeInput.value,10) || 2048;
        tmp.width = hd;
        tmp.height = hd;
        const ctx = tmp.getContext('2d');     
        const img = new Image();
        img.onload = ()=>{
          ctx.fillStyle = 'white';
          ctx.fillRect(0,0,hd,hd);
          ctx.drawImage(canvas, 0, 0, hd, hd);
          const pngData = tmp.toDataURL('image/png');
          const svg = `<?xml version="1.0" encoding="UTF-8"?>\n`+
                      `<svg xmlns='http://www.w3.org/2000/svg' width='${hd}' height='${hd}' viewBox='0 0 ${hd} ${hd}'>`+
                      `<image href='${pngData}' width='${hd}' height='${hd}'/></svg>`;
          const blob = new Blob([svg], {type: 'image/svg+xml'});
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'qr.svg';
          a.click();
          URL.revokeObjectURL(url);
        };
        
        img.src = canvas.toDataURL('image/png');
        return;
      }
      const hd = parseInt(hdSizeInput.value,10) || 2048;
      
      const temp = document.createElement('canvas');
      temp.width = hd;
      temp.height = hd;
      const ctx = temp.getContext('2d');

      
      const img = new Image();
      img.onload = ()=>{
        ctx.fillStyle = 'white';
        ctx.fillRect(0,0,hd,hd);
        ctx.imageSmoothingEnabled = false; 
        ctx.drawImage(img, 0, 0, hd, hd);

        temp.toBlob((blob)=>{
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `qr_hd_${hd}x${hd}.png`;
          a.click();
          URL.revokeObjectURL(url);
        }, 'image/png');
      };
      img.src = canvas.toDataURL('image/png');
    });

    
    copyBtn.addEventListener('click', async ()=>{
      try{
        const blob = await new Promise(res=>canvas.toBlob(res));
        await navigator.clipboard.write([new ClipboardItem({'image/png': blob})]);
        alert('Imagen copiada al portapapeles.');
      }catch(e){
        console.error(e);
        alert('No se pudo copiar: tu navegador puede no soportar la API del portapapeles para imágenes.');
      }
    });


    updatePreviewSize();
    qr.value = input.value;
  </script>
</body>
</html>
